---
- name: Install some required packages from apt
  apt:
      name={{ item }} state=installed
  with_items:
    - mysql-client
    - mysql-server
    - mysql-common
    - libmysqlclient-dev
    - python-mysqldb
    - xvfb
    - r-base
  sudo: true
- name: Install a few R packages
  command: /usr/bin/Rscript --slave --no-save --no-restore-history -e "if (! ('{{item}}' %in% installed.packages()[,'Package'])) install.packages(pkgs='{{item}}', repos=c('http://www.freestatistics.org/cran/'))"
  with_items:
    - argparse
  sudo: true
- name: Start the MySQL service
  sudo: yes
  service:
    name: mysql
    state: started
    enabled: true
- name: Update mysql root password for all root accounts
  sudo: yes
  mysql_user:
    name=root
    host={{ item }}
    password={{ mysql_root_password }}
    login_user=root
    login_password={{ mysql_root_password }}
    check_implicit_admin=yes
    priv=*.*:ALL,GRANT
  with_items:
    - 127.0.0.1
    - ::1
    - localhost
    - '%'
- name: Create symlink to sciluigi_usecase project folder
  file:
      src=/vagrant/roles/sciluigi_usecase/files/proj
      dest=/home/ubuntu/proj
      state=link
